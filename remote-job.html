<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI CV/Resume Builder - AutoFlow</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Page-specific styles */
        body {
            background: #f9fafb;
            padding: 40px 20px;
        }

        .page-container {
            max-width: 700px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 16px;
            padding: 50px 45px;
            box-shadow: 
                0 10px 15px -3px rgba(0, 0, 0, 0.1),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #6366f1;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 30px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: #4f46e5;
        }

        .back-link::before {
            content: '‚Üê';
            font-size: 1.25rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .ai-badge::before {
            content: 'üíº';
            font-size: 1rem;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 14px;
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: #6b7280;
            line-height: 1.7;
        }

        .info-box {
            background: #f0fdf4;
            border: 1px solid #dcfce7;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            color: #065f46;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .info-box strong {
            display: block;
            margin-bottom: 4px;
            color: #047857;
        }

        .form-grid {
            display: grid;
            gap: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .required {
            color: #ef4444;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 14px;
            font-size: 0.95rem;
            color: #1f2937;
            background: #ffffff;
            border: 1.5px solid #d1d5db;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        /* Hidden field animation */
        .form-group.hidden {
            display: none;
        }

        .form-group.show {
            display: flex;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .submit-button {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 16px;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .confirmation {
            display: none;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 18px 24px;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 24px;
        }

        .confirmation.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Unauthorized access message */
        .unauthorized-message {
            display: none;
            background: #fee2e2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            margin-top: 40px;
        }

        .unauthorized-message.show {
            display: block;
        }

        .unauthorized-message h2 {
            color: #dc2626;
            margin-bottom: 12px;
            font-size: 1.5rem;
        }

        .unauthorized-message p {
            color: #991b1b;
            margin-bottom: 16px;
        }

        .unauthorized-message a {
            display: inline-block;
            padding: 10px 20px;
            background: #dc2626;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .unauthorized-message a:hover {
            background: #991b1b;
        }

        @media (max-width: 768px) {
            .page-container {
                padding: 40px 24px;
            }
            .page-title {
                font-size: 2rem;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <a href="index.html" class="back-link">Back to Workflows</a>

        <div id="authorizedContent">
            <div class="page-header">
                <span class="ai-badge">AI-Powered Career Tool</span>
                <h1 class="page-title">Smart Job Finder</h1>
                <p class="page-subtitle">Submit your details and get instant AI-matched remote/on-premises jobs based on your skills and preferences.</p>
            </div>

            <div class="info-box">
                <strong>üöÄ Accelerate Your Job Search</strong>
                Tell us what you're good at‚Äîour AI will scan the market and bring you remote jobs that fit.
            </div>

            <form id="resumeForm" action="https://hussainsaleem.app.n8n.cloud/webhook/d7e74325-b7d6-436b-95ab-7130bc829a5c" method="POST">
                <div class="form-grid">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fullName">Full Name <span class="required">*</span></label>
                            <input type="text" id="fullName" name="fullName" placeholder="John Doe" required>
                        </div>

                        <div class="form-group">
                            <label for="phoneNumber">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="+1 (555) 000-0000" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="emailAddress">Email Address <span class="required">*</span></label>
                            <input type="email" id="emailAddress" name="emailAddress" placeholder="your.email@example.com" required>
                        </div>

                        <div class="form-group">
                            <label for="jobTitle">Job Title<span class="required">*</span></label>
                            <input type="text" id="jobTitle" name="jobTitle" placeholder="e.g., Senior Software Engineer" required>
                        </div>
                    </div>

                    <!-- New Job Type Dropdown -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jobType">Job Type <span class="required">*</span></label>
                            <select id="jobType" name="jobType" required>
                                <option value="">Select job type</option>
                                <option value="remote">Remote</option>
                                <option value="on-premises">On-Premises</option>
                            </select>
                        </div>

                        <!-- Conditional Country Field -->
                        <div class="form-group hidden" id="countryGroup">
                            <label for="country">Country <span class="required">*</span></label>
                            <input type="text" id="country" name="country" placeholder="e.g., United States">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="education">Education Level</label>
                        <textarea id="education" name="education" placeholder="List degrees, institutions, and graduation years."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="experience">Work Experience</label>
                        <textarea id="experience" name="experience" placeholder="Describe your roles, responsibilities, and key achievements."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="keySkills">Key Skills</label>
                        <textarea id="keySkills" name="keySkills" placeholder="List technical and soft skills (e.g., Python, AWS, Leadership)."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="certifications">Certifications (Optional)</label>
                        <input type="text" id="certifications" name="certifications" placeholder="e.g., PMP, AWS Certified Solutions Architect">
                    </div>
                </div>

                <button type="submit" class="submit-button">Find Job Leads</button>
            </form>

            <div id="confirmation" class="confirmation">
                ‚úÖ Your request has been received. We'll email you job leads soon.
            </div>
        </div>

        <div id="unauthorizedMessage" class="unauthorized-message">
            <h2>Access Denied</h2>
            <p>You need a valid access token to use this workflow. Please start from the main page and verify your token first.</p>
            <a href="index.html">‚Üê Back to Main Page</a>
        </div>
    </div>

    <script>
        // ========================================
        // TOKEN VERIFICATION
        // ========================================
        
        const VERIFY_TOKEN_URL = 'https://hussainsaleem.app.n8n.cloud/webhook/tokenVerification';
        const STORAGE_KEY = 'oneTimeAccess';

        function verifyTokenAccess() {
            // Check if a valid session token exists locally
            // We only check for local presence, not backend verification
            // because the backend treats these as one-time tokens
            
            const session = localStorage.getItem(STORAGE_KEY);
            
            if (!session) {
                console.warn('No session found in localStorage');
                return false;
            }

            try {
                const data = JSON.parse(session);
                
                if (!data.token) {
                    console.warn('No token in session data');
                    return false;
                }

                console.log('Valid session token found locally');
                return true;
            } catch (e) {
                console.warn('Failed to parse session:', e);
                return false;
            }
        }

        function showUnauthorized() {
            const authorizedContent = document.getElementById('authorizedContent');
            const unauthorizedMessage = document.getElementById('unauthorizedMessage');
            
            if (authorizedContent) {
                authorizedContent.style.display = 'none';
            }
            if (unauthorizedMessage) {
                unauthorizedMessage.classList.add('show');
            }
        }

        function showAuthorized() {
            const authorizedContent = document.getElementById('authorizedContent');
            const unauthorizedMessage = document.getElementById('unauthorizedMessage');
            
            if (authorizedContent) {
                authorizedContent.style.display = 'block';
            }
            if (unauthorizedMessage) {
                unauthorizedMessage.classList.remove('show');
            }
        }

        // ========================================
        // PAGE INITIALIZATION - VERIFY TOKEN FIRST
        // ========================================

        document.addEventListener('DOMContentLoaded', function() {
            const isAuthorized = verifyTokenAccess();
            
            if (isAuthorized) {
                showAuthorized();
                initializeForm();
            }
        });

        // ========================================
        // FORM LOGIC (only runs if authorized)
        // ========================================

        function initializeForm() {
            // Toggle country field based on job type selection
            const jobTypeSelect = document.getElementById('jobType');
            const countryGroup = document.getElementById('countryGroup');
            const countryInput = document.getElementById('country');

            jobTypeSelect.addEventListener('change', function() {
                if (this.value === 'on-premises') {
                    countryGroup.classList.remove('hidden');
                    countryGroup.classList.add('show');
                    countryInput.setAttribute('required', 'required');
                } else {
                    countryGroup.classList.add('hidden');
                    countryGroup.classList.remove('show');
                    countryInput.removeAttribute('required');
                    countryInput.value = '';
                }
            });

            // Form submission handler
            document.getElementById('resumeForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(this);

                fetch(this.action, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    document.getElementById('confirmation').classList.add('show');
                    this.reset();
                    
                    // Reset the country field visibility
                    countryGroup.classList.add('hidden');
                    countryGroup.classList.remove('show');
                    countryInput.removeAttribute('required');
                    
                    // Clear the session token
                    localStorage.removeItem(STORAGE_KEY);
                    
                    // Redirect back to index.html after 2 seconds
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                })
                .catch(error => {
                    document.getElementById('confirmation').classList.add('show');
                    this.reset();
                    
                    countryGroup.classList.add('hidden');
                    countryGroup.classList.remove('show');
                    countryInput.removeAttribute('required');
                    
                    localStorage.removeItem(STORAGE_KEY);
                    
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                });
            });
        }
    </script>
    
</body>
</html>
